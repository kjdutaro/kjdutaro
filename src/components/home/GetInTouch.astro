---
import { Mail, Phone, Github, Linkedin } from '@lucide/astro';

interface Props { column?: 1 | 2; }
const { column } = Astro.props;
---

<section
  id="contact"
  aria-label="Contact"
  class="min-w-[100vw] w-max shrink-0 h-full min-h-0 flex flex-row items-stretch pt-20 pb-24 md:pb-28 bg-[var(--bg-primary)]"
>
  <div class="parallax-strip flex-1 flex flex-row w-full min-h-0" data-parallax-rate="0.12">
  <div class="section-rail section-rail--projects">
    <span class="section-rail-text">Contact</span>
  </div>

  <div class="flex-1 flex justify-center items-center min-h-0">
    <div class="px-4 md:px-6 lg:px-8 max-w-5xl mx-auto w-full">
      {!column && (
        <>
          <div class="grid md:grid-cols-2 gap-12">
            <div>
              <p class="text-[var(--text-muted)] mb-6 max-w-md">Reach me by email or phone, or connect on GitHub and LinkedIn.</p>
              <div class="space-y-4">
                <a href="mailto:kjdutaro@gmail.com" class="flex items-center gap-4 p-4 rounded-xl border border-[var(--border-default)] bg-[var(--bg-surface)] hover:border-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)]">
                  <Mail size={22} class="text-[var(--accent)] shrink-0" aria-hidden="true" />
                  <div><p class="text-xs text-[var(--text-subtle)]">Email</p><p class="font-medium text-[var(--text-primary)]">kjdutaro@gmail.com</p></div>
                </a>
                <a href="tel:+639561793552" class="flex items-center gap-4 p-4 rounded-xl border border-[var(--border-default)] bg-[var(--bg-surface)] hover:border-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)]">
                  <Phone size={22} class="text-[var(--accent)] shrink-0" aria-hidden="true" />
                  <div><p class="text-xs text-[var(--text-subtle)]">Phone</p><p class="font-medium text-[var(--text-primary)]">+63 956 179 3552</p></div>
                </a>
                <div class="pt-4 border-t border-[var(--border-subtle)]">
                  <p class="text-sm text-[var(--text-muted)] mb-3">Connect</p>
                  <div class="flex gap-3">
                    <a href="https://github.com/kjdutaro" target="_blank" rel="noopener noreferrer" class="p-2.5 rounded-lg border border-[var(--border-default)] bg-[var(--bg-surface)] text-[var(--text-muted)] hover:text-[var(--accent)] hover:border-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2" aria-label="GitHub"><Github size={20} aria-hidden="true" /></a>
                    <a href="https://linkedin.com/in/kjdutaro" target="_blank" rel="noopener noreferrer" class="p-2.5 rounded-lg border border-[var(--border-default)] bg-[var(--bg-surface)] text-[var(--text-muted)] hover:text-[var(--accent)] hover:border-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2" aria-label="LinkedIn"><Linkedin size={20} aria-hidden="true" /></a>
                  </div>
                </div>
              </div>
            </div>
            <div>
              <h3 class="font-heading font-semibold text-lg text-[var(--text-primary)] mb-6">Send a message</h3>
              <form id="contact-form" class="space-y-4">
                <div><label for="name" class="block text-sm font-medium text-[var(--text-primary)] mb-1.5">Name</label><input type="text" id="name" name="name" required class="w-full px-4 py-3 rounded-lg bg-[var(--bg-surface)] border border-[var(--border-default)] text-[var(--text-primary)] placeholder-[var(--text-subtle)] focus:outline-none focus:ring-2 focus:ring-[var(--focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] focus:border-transparent transition-colors" placeholder="Your name" /></div>
                <div><label for="email" class="block text-sm font-medium text-[var(--text-primary)] mb-1.5">Email</label><input type="email" id="email" name="email" required class="w-full px-4 py-3 rounded-lg bg-[var(--bg-surface)] border border-[var(--border-default)] text-[var(--text-primary)] placeholder-[var(--text-subtle)] focus:outline-none focus:ring-2 focus:ring-[var(--focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] focus:border-transparent transition-colors" placeholder="your@email.com" /></div>
                <div><label for="subject" class="block text-sm font-medium text-[var(--text-primary)] mb-1.5">Subject</label><input type="text" id="subject" name="subject" required class="w-full px-4 py-3 rounded-lg bg-[var(--bg-surface)] border border-[var(--border-default)] text-[var(--text-primary)] placeholder-[var(--text-subtle)] focus:outline-none focus:ring-2 focus:ring-[var(--focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] focus:border-transparent transition-colors" placeholder="What's this about?" /></div>
                <div><label for="message" class="block text-sm font-medium text-[var(--text-primary)] mb-1.5">Message</label><textarea id="message" name="message" required rows="4" class="w-full px-4 py-3 rounded-lg bg-[var(--bg-surface)] border border-[var(--border-default)] text-[var(--text-primary)] placeholder-[var(--text-subtle)] focus:outline-none focus:ring-2 focus:ring-[var(--focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] focus:border-transparent transition-colors resize-none" placeholder="Tell me about your project..."></textarea></div>
                <button type="submit" class="btn btn-primary w-full h-11 rounded-lg font-medium text-sm">Send message</button>
                <p id="form-status" class="text-sm text-[var(--text-muted)] text-center" aria-live="polite"></p>
              </form>
            </div>
          </div>
        </>
      )}
      {column === 1 && (
        <div>
          <p class="text-[var(--text-muted)] mb-6 max-w-md">
            Reach me by email or phone, or connect on GitHub and LinkedIn.
          </p>
          <div class="space-y-4">
            <a
              href="mailto:kjdutaro@gmail.com"
              class="flex items-center gap-4 p-4 rounded-xl border border-[var(--border-default)] bg-[var(--bg-surface)] hover:border-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)]"
            >
              <Mail size={22} class="text-[var(--accent)] shrink-0" aria-hidden="true" />
              <div>
                <p class="text-xs text-[var(--text-subtle)]">Email</p>
                <p class="font-medium text-[var(--text-primary)]">kjdutaro@gmail.com</p>
              </div>
            </a>
            <a
              href="tel:+639561793552"
              class="flex items-center gap-4 p-4 rounded-xl border border-[var(--border-default)] bg-[var(--bg-surface)] hover:border-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)]"
            >
              <Phone size={22} class="text-[var(--accent)] shrink-0" aria-hidden="true" />
              <div>
                <p class="text-xs text-[var(--text-subtle)]">Phone</p>
                <p class="font-medium text-[var(--text-primary)]">+63 956 179 3552</p>
              </div>
            </a>
            <div class="pt-4 border-t border-[var(--border-subtle)]">
              <p class="text-sm text-[var(--text-muted)] mb-3">Connect</p>
              <div class="flex gap-3">
                <a
                  href="https://github.com/kjdutaro"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="p-2.5 rounded-lg border border-[var(--border-default)] bg-[var(--bg-surface)] text-[var(--text-muted)] hover:text-[var(--accent)] hover:border-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2"
                  aria-label="GitHub"
                >
                  <Github size={20} aria-hidden="true" />
                </a>
                <a
                  href="https://linkedin.com/in/kjdutaro"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="p-2.5 rounded-lg border border-[var(--border-default)] bg-[var(--bg-surface)] text-[var(--text-muted)] hover:text-[var(--accent)] hover:border-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2"
                  aria-label="LinkedIn"
                >
                  <Linkedin size={20} aria-hidden="true" />
                </a>
              </div>
            </div>
          </div>
        </div>
      )}
      {column === 2 && (
        <div>
          <form id="contact-form" class="space-y-4">
            <div>
              <label for="name" class="block text-sm font-medium text-[var(--text-primary)] mb-1.5">Name</label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full px-4 py-3 rounded-lg bg-[var(--bg-surface)] border border-[var(--border-default)] text-[var(--text-primary)] placeholder-[var(--text-subtle)] focus:outline-none focus:ring-2 focus:ring-[var(--focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] focus:border-transparent transition-colors"
                placeholder="Your name"
              />
            </div>
            <div>
              <label for="email" class="block text-sm font-medium text-[var(--text-primary)] mb-1.5">Email</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-3 rounded-lg bg-[var(--bg-surface)] border border-[var(--border-default)] text-[var(--text-primary)] placeholder-[var(--text-subtle)] focus:outline-none focus:ring-2 focus:ring-[var(--focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] focus:border-transparent transition-colors"
                placeholder="your@email.com"
              />
            </div>
            <div>
              <label for="subject" class="block text-sm font-medium text-[var(--text-primary)] mb-1.5">Subject</label>
              <input
                type="text"
                id="subject"
                name="subject"
                required
                class="w-full px-4 py-3 rounded-lg bg-[var(--bg-surface)] border border-[var(--border-default)] text-[var(--text-primary)] placeholder-[var(--text-subtle)] focus:outline-none focus:ring-2 focus:ring-[var(--focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] focus:border-transparent transition-colors"
                placeholder="What's this about?"
              />
            </div>
            <div>
              <label for="message" class="block text-sm font-medium text-[var(--text-primary)] mb-1.5">Message</label>
              <textarea
                id="message"
                name="message"
                required
                rows="4"
                class="w-full px-4 py-3 rounded-lg bg-[var(--bg-surface)] border border-[var(--border-default)] text-[var(--text-primary)] placeholder-[var(--text-subtle)] focus:outline-none focus:ring-2 focus:ring-[var(--focus-ring)] focus:ring-offset-2 focus:ring-offset-[var(--bg-primary)] focus:border-transparent transition-colors resize-none"
                placeholder="Tell me about your project..."
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary w-full h-11 rounded-lg font-medium text-sm">
              Send message
            </button>
            <p id="form-status" class="text-sm text-[var(--text-muted)] text-center" aria-live="polite"></p>
          </form>
        </div>
      )}
    </div>
  </div>
  </div>
</section>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement | null;
  const statusElement = document.getElementById('form-status');

  if (form && statusElement) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const data = {
        name: formData.get('name') as string,
        email: formData.get('email') as string,
        subject: formData.get('subject') as string,
        message: formData.get('message') as string,
      };

      try {
        statusElement.textContent = 'Sending...';
        statusElement.setAttribute('class', 'text-sm text-[var(--text-muted)] text-center');

        const response = await fetch('https://formspree.io/f/myzwpkzp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          statusElement.textContent = "Message sent. I'll get back to you soon.";
          statusElement.setAttribute('class', 'text-sm text-[var(--accent)] text-center');
          form.reset();
          setTimeout(() => {
            statusElement.textContent = '';
          }, 5000);
        } else {
          throw new Error('Failed to send');
        }
      } catch {
        statusElement.textContent = 'Something went wrong. Please email kjdutaro@gmail.com directly.';
        statusElement.setAttribute('class', 'text-sm text-[var(--error)] text-center');
      }
    });
  }
</script>
