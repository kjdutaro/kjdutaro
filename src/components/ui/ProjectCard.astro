---
/**
 * ProjectCard â€” project display card with pixel design.
 * Sharp edges, pixel borders, hover scale on images.
 */
import { Github, ExternalLink } from '@lucide/astro';

const categoryLabels: Record<string, string> = {
  client: "Client Work",
  personal: "Personal",
  academic: "Academic",
  prototype: "Design Prototype",
};

interface Props {
  title: string;
  description: string;
  tech?: string[];
  github?: string;
  liveLink?: string;
  image?: string;
  featured?: boolean;
  category?: "client" | "personal" | "academic" | "prototype";
  href?: string;
}

const { title, description, tech = [], github, liveLink, image, featured = false, category, href } = Astro.props;
const categoryLabel = category ? categoryLabels[category] : null;
---

<article class:list={[
  "group flex flex-col border-2 bg-[var(--bg-surface)] overflow-hidden transition-all duration-200",
  featured
    ? "border-[var(--accent)] shadow-[4px_4px_0_0_var(--accent)]"
    : "border-[var(--border-default)] hover:border-[var(--accent)] hover:shadow-[4px_4px_0_0_var(--accent)]"
]}>
  {href ? (
    <>
      <a href={href} class="block no-underline text-inherit">
        {image && (
          <div class="relative overflow-hidden aspect-video bg-[var(--bg-elevated)]">
            <img
              src={image}
              alt={`Project preview for ${title}`}
              class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.02]"
              loading="lazy"
            />
          </div>
        )}
        <div class="flex flex-col flex-1 p-5 md:p-6 gap-3">
          <div class="flex items-start justify-between gap-4 flex-wrap">
            <h3 class="font-heading font-semibold text-lg text-[var(--text-primary)] leading-tight group-hover:text-[var(--accent)] transition-colors">
              {title}
            </h3>
            <div class="flex flex-wrap gap-2 shrink-0">
              {categoryLabel && (
                <span class="font-mono text-xs px-2 py-0.5 bg-[var(--bg-elevated)] text-[var(--text-muted)] border border-[var(--border-default)] whitespace-nowrap">
                  {categoryLabel}
                </span>
              )}
              {featured && (
                <span class="font-mono text-xs font-medium px-2.5 py-1 bg-[var(--accent-muted)] text-[var(--accent)] border border-[var(--accent)] whitespace-nowrap">
                  Featured
                </span>
              )}
            </div>
          </div>
          <p class="text-sm text-[var(--text-muted)] leading-relaxed flex-1">
            {description}
          </p>
          {tech.length > 0 && (
            <div class="flex flex-wrap gap-2">
              {tech.map((t: string) => (
                <span class="font-mono text-xs px-2 py-0.5 bg-[var(--bg-elevated)] text-[var(--accent)] border border-[var(--border-default)]">
                  {t}
                </span>
              ))}
            </div>
          )}
        </div>
      </a>
      <div class="flex gap-3 px-5 md:px-6 pb-5 md:pb-6 pt-2 border-t-2 border-[var(--border-default)]">
        {github && (
          <a
            href={github}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 font-mono text-xs text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] px-2 py-1 border border-transparent hover:border-[var(--border-default)]"
            aria-label={`View ${title} on GitHub`}
          >
            <Github size={14} aria-hidden="true" />
            Code
          </a>
        )}
        {liveLink && (
          <a
            href={liveLink}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 font-mono text-xs text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] px-2 py-1 border border-transparent hover:border-[var(--border-default)]"
            aria-label={`View ${title} live`}
          >
            <ExternalLink size={14} aria-hidden="true" />
            Demo
          </a>
        )}
      </div>
    </>
  ) : (
    <>
      {image && (
        <div class="relative overflow-hidden aspect-video bg-[var(--bg-elevated)]">
          <img src={image} alt={`Project preview for ${title}`} class="w-full h-full object-cover" loading="lazy" />
        </div>
      )}
      <div class="flex flex-col flex-1 p-5 md:p-6 gap-3">
        <div class="flex items-start justify-between gap-4 flex-wrap">
          <h3 class="font-heading font-semibold text-lg text-[var(--text-primary)] leading-tight">
            {title}
          </h3>
          <div class="flex flex-wrap gap-2 shrink-0">
            {categoryLabel && (
              <span class="font-mono text-xs px-2 py-0.5 bg-[var(--bg-elevated)] text-[var(--text-muted)] border border-[var(--border-default)] whitespace-nowrap">
                {categoryLabel}
              </span>
            )}
            {featured && (
              <span class="shrink-0 font-mono text-xs font-medium px-2.5 py-1 bg-[var(--accent-muted)] text-[var(--accent)] border border-[var(--accent)] whitespace-nowrap">
                Featured
              </span>
            )}
          </div>
        </div>
        <p class="text-sm text-[var(--text-muted)] leading-relaxed">
          {description}
        </p>
        {tech.length > 0 && (
          <div class="flex flex-wrap gap-2">
            {tech.map((t: string) => (
              <span class="font-mono text-xs px-2 py-0.5 bg-[var(--bg-elevated)] text-[var(--accent)] border border-[var(--border-default)]">
                {t}
              </span>
            ))}
          </div>
        )}
      </div>
      <div class="flex gap-3 px-5 md:px-6 pb-5 md:pb-6 pt-2 border-t-2 border-[var(--border-default)]">
        {github && (
          <a
            href={github}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 font-mono text-xs text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] px-2 py-1 border border-transparent hover:border-[var(--border-default)]"
            aria-label={`View ${title} on GitHub`}
          >
            <Github size={14} aria-hidden="true" />
            Code
          </a>
        )}
        {liveLink && (
          <a
            href={liveLink}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 font-mono text-xs text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] px-2 py-1 border border-transparent hover:border-[var(--border-default)]"
            aria-label={`View ${title} live`}
          >
            <ExternalLink size={14} aria-hidden="true" />
            Demo
          </a>
        )}
      </div>
    </>
  )}
</article>
