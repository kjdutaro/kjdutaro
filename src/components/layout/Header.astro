---
import { Menu, X, Sun, Moon } from '@lucide/astro';
---
<header class="sticky top-0 z-50 shrink-0 border-b border-[var(--border-subtle)] bg-[var(--bg-primary)]/95 backdrop-blur-md transition-colors duration-300">
  <nav class="max-w-5xl mx-auto px-4 md:px-6 lg:px-8 py-4 flex justify-between items-center" aria-label="Main navigation">
    <a
      href="/"
      class="font-heading font-semibold text-[var(--text-primary)] text-lg tracking-tight hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] rounded px-2 py-1"
      aria-label="KJ Dutaro â€“ Home"
    >
      KJ
    </a>

    <div class="flex items-center gap-4">
      <div class="hidden md:flex items-center gap-8">
        <a
          href="/#projects"
          class="text-sm font-medium text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] rounded px-2 py-1"
        >
          Projects
        </a>
        <a
          href="/#about"
          class="text-sm font-medium text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] rounded px-2 py-1"
        >
          About
        </a>
        <a
          href="/blog"
          class="text-sm font-medium text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] rounded px-2 py-1"
        >
          Blog
        </a>
        <a
          href="/#contact"
          class="text-sm font-medium text-[var(--text-muted)] hover:text-[var(--accent)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)] rounded px-2 py-1"
        >
          Contact
        </a>
      </div>
      <button
        id="theme-toggle"
        type="button"
        aria-label="Toggle light/dark mode"
        title="Toggle theme"
        class="p-2 rounded-lg text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-elevated)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)]"
      >
        <Sun size={20} class="dark:hidden" aria-hidden="true" />
        <Moon size={20} class="hidden dark:block" aria-hidden="true" />
      </button>
      <button
        id="mobile-menu-toggle"
        type="button"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
        class="md:hidden p-2 rounded-lg text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-elevated)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--bg-primary)]"
      >
        <Menu size={24} id="menu-icon" aria-hidden="true" />
        <X size={24} id="close-icon" class="hidden" aria-hidden="true" />
      </button>
    </div>
  </nav>

  <div
    id="mobile-menu"
    class="hidden md:hidden border-t border-[var(--border-subtle)] bg-[var(--bg-primary)]"
    role="navigation"
    aria-label="Mobile menu"
  >
    <div class="px-4 py-4 flex flex-col gap-1 max-w-5xl mx-auto">
      <a href="/#projects" class="px-4 py-3 rounded-lg text-[var(--text-primary)] font-medium hover:bg-[var(--bg-elevated)] hover:text-[var(--accent)] transition-colors focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-inset">
        Projects
      </a>
      <a href="/#about" class="px-4 py-3 rounded-lg text-[var(--text-primary)] font-medium hover:bg-[var(--bg-elevated)] hover:text-[var(--accent)] transition-colors focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-inset">
        About
      </a>
      <a href="/blog" class="px-4 py-3 rounded-lg text-[var(--text-primary)] font-medium hover:bg-[var(--bg-elevated)] hover:text-[var(--accent)] transition-colors focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-inset">
        Blog
      </a>
      <a href="/#contact" class="px-4 py-3 rounded-lg text-[var(--text-primary)] font-medium hover:bg-[var(--bg-elevated)] hover:text-[var(--accent)] transition-colors focus-visible:ring-2 focus-visible:ring-[var(--focus-ring)] focus-visible:ring-inset">
        Contact
      </a>
    </div>
  </div>
</header>

<!-- Theme toggle: inline, one listener on document so it works after View Transitions -->
<script is:inline>
  (function() {
    if (window.__themeToggleReady) return;
    window.__themeToggleReady = true;
    document.addEventListener('click', function(e) {
      var btn = (e.target && e.target.closest && e.target.closest('#theme-toggle'));
      if (!btn) return;
      var html = document.documentElement;
      var isDark = html.classList.contains('dark');
      if (isDark) {
        html.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        html.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
    });
  })();
</script>

<script>
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  if (mobileMenuToggle && mobileMenu && menuIcon && closeIcon) {
    mobileMenuToggle.addEventListener('click', () => {
      const isOpen = !mobileMenu.classList.contains('hidden');
      mobileMenu.classList.toggle('hidden');
      menuIcon.classList.toggle('hidden');
      closeIcon.classList.toggle('hidden');
      mobileMenuToggle.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
    });

    mobileMenu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        mobileMenuToggle.setAttribute('aria-expanded', 'false');
      });
    });
  }
</script>
