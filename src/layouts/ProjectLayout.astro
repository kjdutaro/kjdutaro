---
/**
 * ProjectLayout — wraps individual project detail pages with pixel design.
 * Metadata, tech tags, prose content, and action links.
 */
import BaseLayout from "./BaseLayout.astro";
import { Github, ExternalLink } from "@lucide/astro";
import type { CollectionEntry } from "astro:content";
import profile from "../data/profile";

interface Props {
  entry: CollectionEntry<"projects">;
}

const { entry } = Astro.props;
const { title, description, tech, github, liveLink, date } = entry.data;

const schemaMarkup = {
  "@context": "https://schema.org",
  "@type": "CreativeWork",
  name: title,
  description,
  datePublished: date.toISOString(),
  creator: {
    "@type": "Person",
    name: profile.name,
    url: profile.siteUrl,
  },
  keywords: tech.join(", "),
  image: entry.data.image ? new URL(entry.data.image, Astro.site).toString() : new URL(profile.seo.defaultOgImage, Astro.site).toString(),
  url: new URL(`/projects/${entry.slug}`, Astro.site).toString(),
  mainEntityOfPage: {
    "@type": "WebPage",
    "@id": new URL(`/projects/${entry.slug}`, Astro.site).toString(),
  },
  inLanguage: "en-US",
};
---

<BaseLayout
  title={`${title} – ${profile.name}`}
  description={description}
  canonical={`/projects/${entry.slug}`}
  ogImage={entry.data.image || profile.seo.defaultOgImage}
>
  <script
    type="application/ld+json"
    set:html={JSON.stringify(schemaMarkup)}
  />
  <article class="c-section">
    <div class="c-container max-w-3xl">
      <!-- Project header -->
      <div class="mb-8 pb-6 border-b-2 border-[var(--border-default)]">
        <p class="c-section-eyebrow">Project</p>
        <h1
          class="font-heading text-2xl md:text-3xl lg:text-4xl font-bold mb-4 text-[var(--text-primary)]"
        >
          {title}
        </h1>
        <p class="font-mono text-xs text-[var(--text-muted)]">
          {
            new Date(date).toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })
          }
        </p>
      </div>

      <!-- Tech stack tags -->
      {
        tech.length > 0 && (
          <div class="flex flex-wrap gap-2 mb-8">
            {tech.map((t) => (
              <span class="font-mono text-xs bg-[var(--bg-elevated)] text-[var(--accent)] px-2.5 py-0.5 border border-[var(--border-default)]">
                {t}
              </span>
            ))}
          </div>
        )
      }

      <!-- Project content -->
      <div class="prose max-w-none mb-8">
        <slot />
      </div>

      <!-- Action links -->
      <div class="flex gap-3 pt-8 border-t-2 border-[var(--border-default)]">
        {
          github && (
            <a
              href={github}
              target="_blank"
              rel="noopener noreferrer"
              class="c-btn c-btn-ghost text-xs h-9 px-4"
              aria-label={`View ${title} on GitHub`}
            >
              <Github size={16} aria-hidden="true" />
              View on GitHub
            </a>
          )
        }
        {
          liveLink && (
            <a
              href={liveLink}
              target="_blank"
              rel="noopener noreferrer"
              class="c-btn c-btn-secondary text-xs h-9 px-4"
              aria-label={`View ${title} live demo`}
            >
              <ExternalLink size={16} aria-hidden="true" />
              Live Demo
            </a>
          )
        }
      </div>
    </div>
  </article>
</BaseLayout>
