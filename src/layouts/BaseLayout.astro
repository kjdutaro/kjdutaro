---
/**
 * BaseLayout — root HTML shell shared by all pages.
 * Provides <head> metadata, theme init (flash-free), Header and Footer.
 * All personal data comes from src/data/profile.ts (single source of truth).
 */
import "../styles/global.css";
import Header from "../components/layout/Header.astro";
import Footer from "../components/layout/Footer.astro";
import { ClientRouter } from "astro:transitions";
import profile from "../data/profile";

const {
  title,
  description = profile.seo.defaultDescription,
  keywords = profile.seo.defaultKeywords,
  ogImage = profile.seo.defaultOgImage,
  canonical = Astro.url.pathname,
} = Astro.props;

const defaultKeywords = profile.seo.defaultKeywords;
const metaKeywords = keywords ?? defaultKeywords;

/* JSON-LD structured data for Person / Organization / Website / Professional Service / WebPage — Enhanced for SEO */
const schemaMarkup = [
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    name: `${profile.name} - Web Development`,
    alternateName: profile.fullName,
    url: profile.siteUrl,
    description: "Full Stack Developer portfolio offering web development, WordPress themes, and map integration services.",
    image: new URL(ogImage, Astro.site).toString(),
    email: profile.contact.email,
    telephone: profile.contact.phone,
    sameAs: [profile.social.github, profile.social.linkedin],
    founder: {
      "@type": "Person",
      name: profile.fullName,
      url: profile.siteUrl
    },
    areaServed: "Worldwide",
    availableLanguage: ["en"],
    contactPoint: {
      "@type": "ContactPoint",
      email: profile.contact.email,
      telephone: profile.contact.phone,
      availableLanguage: ["English"],
      contactType: "customer service"
    }
  },
  {
    "@context": "https://schema.org",
    "@type": "Person",
    name: profile.fullName,
    alternateName: profile.name,
    url: profile.siteUrl,
    image: new URL(ogImage, Astro.site).toString(),
    jobTitle: profile.title,
    description: description,
    email: profile.contact.email,
    telephone: profile.contact.phone,
    sameAs: [profile.social.github, profile.social.linkedin],
    knowsAbout: profile.knowsAbout,
    address: {
      "@type": "PostalAddress",
      ...profile.structuredData.person.address,
    },
    areaServed: {
      "@type": "Place",
      name: "Worldwide",
    },
    workLocation: {
      "@type": "Place",
      name: "Remote",
    },
    alumniOf: {
      "@type": "EducationalOrganization",
      ...profile.structuredData.person.alumniOf,
    },
    hasCredential: profile.structuredData.person.hasCredential.map((cred: { name: string; credentialCategory: string }) => ({
      "@type": "EducationalOccupationalCredential",
      ...cred,
    })),
  },
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    name: `${profile.name}`,
    alternateName: `${profile.fullName} Portfolio`,
    url: profile.siteUrl,
    description: description,
    inLanguage: "en-US",
    isPartOf: {
      "@type": "WebSite",
      name: profile.siteUrl,
      url: profile.siteUrl,
    },
    potentialAction: {
      "@type": "SearchAction",
      target: {
        "@type": "EntryPoint",
        urlTemplate: `${profile.siteUrl}/search?q={search_term_string}`,
      },
      "query-input": "required name=search_term_string",
    },
  },
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    name: title,
    description: description,
    url: new URL(canonical, Astro.site).toString(),
    inLanguage: "en-US",
    isPartOf: {
      "@type": "WebSite",
      name: `${profile.name}`,
      url: profile.siteUrl,
    },
    about: {
      "@type": "Thing",
      name: "Web Development Portfolio",
      description: "Professional portfolio showcasing frontend development projects and services",
    },
    dateModified: new Date().toISOString(),
    primaryImageOfPage: {
      "@type": "ImageObject",
      url: new URL(ogImage, Astro.site).toString(),
    },
  },
  {
    "@context": "https://schema.org",
    "@type": "ProfessionalService",
    name: `${profile.name} - Web Development Services`,
    alternateName: `${profile.fullName} Web Development`,
    url: profile.siteUrl,
    description: "Full Stack Development services specializing in JavaScript, HTML, CSS, and modern web technologies.",
    areaServed: "Worldwide",
    availableLanguage: ["English"],
      serviceType: [
      "Web Development",
      "Full Stack Development",
      "WordPress Theme Development",
      "Chrome Extension Development",
      "Website Maintenance",
      "Localization Services",
    ],
    provider: {
      "@type": "Person",
      name: profile.name,
      alternateName: profile.fullName,
    },
    contactPoint: {
      "@type": "ContactPoint",
      email: profile.contact.email,
      telephone: profile.contact.phone,
      availableLanguage: ["English"],
      contactType: "professional services",
    },
  },
];
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={metaKeywords} />
    <meta name="author" content={profile.fullName} />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="googlebot" content="index, follow" />
    <meta name="bingbot" content="index, follow" />
    
    <!-- Language and revisit settings -->
    <meta name="language" content="English" />
    <meta name="revisit-after" content="7 days" />
    <meta name="rating" content="general" />
    
    <!-- Brand name reinforcement -->
    <meta name="application-name" content={profile.name} />
    <meta name="apple-mobile-web-app-title" content={profile.name} />
    <meta name="msapplication-TileColor" content="#0a0a0b" />
    
    <!-- Performance: DNS prefetch for external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    
    <!-- Geo + international audience -->
    <meta name="geo.region" content="PH" />
    <meta name="geo.placename" content="Philippines" />
    <meta property="og:locale" content="en_US" />

    <!-- Canonical URL -->
    <link rel="canonical" href={new URL(canonical, Astro.site)} />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content={profile.fullName} />
    <meta property="og:url" content={new URL(canonical, Astro.site)} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(ogImage, Astro.site)} />
    <meta property="og:image:alt" content={`${profile.fullName} - ${profile.title}`} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    
    <!-- Search engine brand reinforcement -->
    <meta name="site_name" content={profile.name} />
    <meta name="page-topic" content="Personal Portfolio, Web Development" />
    <meta property="og:locale:alternative" content="en_PH" />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@kjorken" />
    <meta name="twitter:creator" content="@kjorken" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={new URL(ogImage, Astro.site)} />

    <!-- JSON-LD Schema -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify(schemaMarkup)}
    />

    <!-- Comprehensive Favicon -->
    <meta name="theme-color" content="#0a0a0b">
    <meta name="msapplication-TileColor" content="#0a0a0b">
    <meta name="msapplication-TileImage" content="/assets/icons/icon128.png" />
    <meta name="format-detection" content="telephone=no">
    <link rel="icon" type="image/x-icon" href="/assets/icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/icon16.png">
    <link rel="icon" type="image/png" sizes="24x24" href="/assets/icons/icon24.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/icon32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/assets/icons/icon48.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/assets/icons/icon64.png">
    <link rel="icon" type="image/png" sizes="128x128" href="/assets/icons/icon128.png">
    <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-chrome.png">

    <!-- Humans.txt & LLMs.txt -->
    <link rel="author" href="/humans.txt" />
    <link rel="alternate" type="text/plain" href="/llms.txt" title="LLM-friendly site info" />

    <!-- View Transitions for smooth page navigation -->
    <ClientRouter />
  </head>

  <body
    class="bg-[var(--bg-primary)] text-[var(--text-primary)] flex flex-col min-h-screen"
  >
    <Header />
    <main class="flex-1" id="main-content">
      <slot />
    </main>
    <Footer />
  </body>
</html>
